<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Avatar Customizer - Dressify AI</title>
  <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f8f9fa;
      color: #333;
    }

    /* Navbar Styles */
    .navbar {
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 70px;
    }

    .nav-brand {
      display: flex;
      align-items: center;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .nav-brand a {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #667eea;
      text-decoration: none;
      transition: color 0.3s;
    }

    .nav-brand a:hover {
      color: #764ba2;
    }

    .nav-brand i {
      font-size: 1.8rem;
    }

    .nav-menu {
      display: flex;
      list-style: none;
      gap: 5px;
      align-items: center;
    }

    .nav-link {
      color: #333;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 6px;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      font-size: 0.95rem;
    }

    .nav-link:hover {
      background: #f0f0f0;
      color: #667eea;
    }

    .nav-link.active {
      background: #667eea;
      color: white;
    }

    .nav-link.auth-btn {
      border: 2px solid #e0e0e0;
      color: #333;
    }

    .nav-link.auth-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }

    .nav-link.auth-btn.primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
    }

    .nav-link.auth-btn.primary:hover {
      background: linear-gradient(135deg, #764ba2 0%, #667eea 100%);
    }

    .nav-divider {
      width: 1px;
      height: 30px;
      background: #e0e0e0;
      margin: 0 5px;
    }

    .nav-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #333;
    }

    @media (max-width: 768px) {
      .nav-container {
        height: 60px;
        padding: 0 15px;
      }

      .nav-toggle {
        display: flex;
        align-items: center;
      }

      .nav-menu {
        position: absolute;
        top: 60px;
        left: 0;
        right: 0;
        background: white;
        flex-direction: column;
        gap: 0;
        border-top: 1px solid #e0e0e0;
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .nav-menu.active {
        max-height: 500px;
      }

      .nav-menu li {
        width: 100%;
      }

      .nav-link {
        width: 100%;
        padding: 15px 20px;
        border-radius: 0;
        justify-content: flex-start;
      }

      .nav-divider {
        width: 100%;
        height: 1px;
        margin: 5px 0;
      }

      .nav-brand span {
        display: none;
      }

      .nav-brand i {
        font-size: 1.5rem;
      }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 20px;
    }

    .header {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
    }

    .header h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .card h2 {
      color: #333;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card h2 i {
      color: #667eea;
      font-size: 1.5rem;
    }

    /* Avatar Display */
    .avatar-display {
      text-align: center;
      padding: 40px;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 15px;
      margin-bottom: 20px;
    }

    .avatar-preview-container {
      position: relative;
      width: 100%;
      margin-bottom: 15px;
    }

    .avatar-image {
      width: 200px;
      height: 250px;
      margin: 0 auto 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      color: white;
      transition: transform 0.3s;
      position: relative;
    }

    .avatar-image:hover {
      transform: scale(1.05);
    }

    .avatar-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 15px;
    }

    .avatar-image.placeholder {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .avatar-rotation-controls {
      display: flex;
      gap: 10px;
      justify-content: center;
      margin-top: 15px;
    }

    .avatar-rotation-controls button {
      padding: 10px 20px;
      border: 2px solid #667eea;
      background: white;
      color: #667eea;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .avatar-rotation-controls button:hover {
      background: #667eea;
      color: white;
      transform: translateY(-2px);
    }

    .avatar-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .avatar-image.placeholder {
      background: #ddd;
      color: #999;
      font-size: 3rem;
    }

    .current-outfit {
      background: #f8f9ff;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
    }

    .outfit-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #e0e0e0;
    }

    .outfit-item:last-child {
      border-bottom: none;
    }

    .outfit-label {
      font-weight: 600;
      color: #667eea;
    }

    .outfit-value {
      color: #666;
    }

    /* Form Section */
    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      color: #333;
      font-weight: 600;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-family: 'Poppins', sans-serif;
      transition: border-color 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    /* Upload Area */
    .upload-area {
      border: 3px dashed #667eea;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 15px;
    }

    .upload-area:hover {
      background: #f8f9ff;
      border-color: #764ba2;
    }

    .upload-area.active {
      background: #f0f4ff;
      border-color: #667eea;
    }

    .upload-area i {
      font-size: 2rem;
      color: #667eea;
      margin-bottom: 10px;
    }

    .upload-area p {
      color: #666;
    }

    #avatarImage {
      display: none;
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      width: 100%;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
      margin-right: 10px;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Presets */
    .presets {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .preset-btn {
      padding: 10px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      text-transform: capitalize;
    }

    .preset-btn:hover {
      border-color: #667eea;
      background: #f8f9ff;
    }

    .preset-btn.active {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    /* Clothing Options */
    .clothing-section {
      background: #f8f9ff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
    }

    .clothing-section h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1rem;
    }

    .clothing-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .clothing-item {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.3s;
      text-align: center;
    }

    .clothing-item:hover {
      border-color: #667eea;
      transform: translateY(-5px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
    }

    .clothing-item.selected {
      background: #667eea;
      color: white;
      border-color: #667eea;
    }

    .clothing-image {
      width: 100%;
      height: 120px;
      background: #f0f0f0;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      font-size: 2rem;
      overflow: hidden;
    }

    .clothing-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 6px;
      transition: transform 0.3s;
    }

    .clothing-item:hover .clothing-image img {
      transform: scale(1.1);
    }

    .clothing-name {
      font-weight: 600;
      font-size: 0.9rem;
      margin-bottom: 5px;
    }

    .clothing-color {
      font-size: 0.8rem;
      color: #999;
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e0e0e0;
    }

    .tab {
      padding: 10px 20px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 600;
      color: #999;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
    }

    .tab.active {
      color: #667eea;
      border-bottom-color: #667eea;
    }

    /* Saved Outfits */
    .saved-outfits {
      background: white;
      border-radius: 15px;
      padding: 30px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      margin-bottom: 30px;
    }

    .saved-outfits h2 {
      color: #333;
      margin-bottom: 20px;
    }

    .outfit-card {
      background: #f8f9ff;
      border-left: 4px solid #667eea;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .outfit-info h4 {
      color: #667eea;
      margin-bottom: 5px;
    }

    .outfit-info p {
      color: #666;
      font-size: 0.9rem;
    }

    .outfit-actions {
      display: flex;
      gap: 10px;
    }

    .outfit-actions button {
      padding: 8px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    .btn-load {
      background: #667eea;
      color: white;
    }

    .btn-delete {
      background: #ff6b6b;
      color: white;
    }

    /* Messages */
    .message {
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      display: none;
    }

    .message.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }

    .message.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }

    @media (max-width: 768px) {
      .content {
        grid-template-columns: 1fr;
      }

      .presets {
        grid-template-columns: repeat(3, 1fr);
      }

      .header h1 {
        font-size: 1.8rem;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-brand">
        <a href="index.html">
          <i class="ri-shopping-bag-line"></i>
          <span>Dressify AI</span>
        </a>
      </div>
      
      <button class="nav-toggle" onclick="toggleNavMenu()">
        <i class="ri-menu-line"></i>
      </button>
      
      <ul class="nav-menu" id="navMenu">
        <li><a href="index.html" class="nav-link"><i class="ri-home-line"></i> Home</a></li>
        <li><a href="ai-hub.html" class="nav-link"><i class="ri-sparks-line"></i> AI Hub</a></li>
        <li><a href="gemini_chatbot.html" class="nav-link"><i class="ri-chat-3-line"></i> Chat</a></li>
        <li><a href="products.html" class="nav-link"><i class="ri-store-line"></i> Products</a></li>
        <li class="nav-divider"></li>
        <li><a href="login.html" class="nav-link auth-btn"><i class="ri-login-box-line"></i> Login</a></li>
        <li><a href="signup.html" class="nav-link auth-btn primary"><i class="ri-user-add-line"></i> Sign Up</a></li>
      </ul>
    </div>
  </nav>

  <div class="container">
    <div class="header">
      <h1>üë§ Avatar Customizer</h1>
      <p>Create and customize your fashion avatar</p>
    </div>

    <div class="content">
      <!-- Avatar Display -->
      <div class="card">
        <h2><i class="ri-user-3-line"></i> Your Avatar</h2>
        
        <div class="avatar-display">
          <div class="avatar-preview-container">
            <div class="avatar-image placeholder" id="avatarPreview">
              <i class="ri-user-fill"></i>
            </div>
            <div class="avatar-rotation-controls">
              <button onclick="rotateAvatar('left')" title="Rotate Left"><i class="ri-arrow-left-s-line"></i></button>
              <button onclick="rotateAvatar('right')" title="Rotate Right"><i class="ri-arrow-right-s-line"></i></button>
            </div>
          </div>
          <div id="avatarName" style="font-weight: 600; color: #333; margin-bottom: 10px; text-align: center;">My Avatar</div>
        </div>

        <div class="current-outfit">
          <div style="font-weight: 600; color: #667eea; margin-bottom: 10px;">Current Outfit</div>
          <div class="outfit-item">
            <span class="outfit-label">Top:</span>
            <span class="outfit-value" id="outfit-top">Select a top</span>
          </div>
          <div class="outfit-item">
            <span class="outfit-label">Bottom:</span>
            <span class="outfit-value" id="outfit-bottom">Select bottoms</span>
          </div>
          <div class="outfit-item">
            <span class="outfit-label">Shoes:</span>
            <span class="outfit-value" id="outfit-shoes">Select shoes</span>
          </div>
          <div class="outfit-item">
            <span class="outfit-label">Accessory:</span>
            <span class="outfit-value" id="outfit-accessory">Optional</span>
          </div>
        </div>

        <button class="btn btn-primary" onclick="saveCurrentOutfit()">
          <i class="ri-save-line"></i> Save This Outfit
        </button>

        <button class="btn btn-primary" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); margin-top: 10px;" onclick="downloadAvatar()">
          <i class="ri-download-line"></i> Download Avatar
        </button>
      </div>

      <!-- Customization Panel -->
      <div class="card">
        <h2><i class="ri-palette-line"></i> Customize</h2>

        <div id="messageBox"></div>

        <div class="form-group">
          <label for="avatarNameInput">Avatar Name</label>
          <input type="text" id="avatarNameInput" placeholder="My Fashion Avatar" value="My Fashion Avatar">
        </div>

        <div class="form-group">
          <label>Upload Avatar Image</label>
          <div class="upload-area" id="uploadArea" onclick="document.getElementById('avatarImage').click()">
            <i class="ri-image-add-line"></i>
            <p>Click or drag image here</p>
          </div>
          <input type="file" id="avatarImage" accept="image/*">
        </div>

        <div class="form-group">
          <label for="skinTone">Skin Tone</label>
          <select id="skinTone">
            <option value="light">Light</option>
            <option value="medium" selected>Medium</option>
            <option value="dark">Dark</option>
            <option value="warm">Warm</option>
            <option value="cool">Cool</option>
          </select>
        </div>

        <div class="form-group">
          <label for="bodyType">Body Type</label>
          <select id="bodyType">
            <option value="average" selected>Average</option>
            <option value="athletic">Athletic</option>
            <option value="petite">Petite</option>
            <option value="tall">Tall</option>
            <option value="curvy">Curvy</option>
          </select>
        </div>

        <button class="btn btn-primary" onclick="createAvatar()">
          <i class="ri-user-add-line"></i> Create/Update Avatar
        </button>
      </div>
    </div>

    <!-- Clothing Presets -->
    <div class="card">
      <h2><i class="ri-shirt-line"></i> Style Presets</h2>
      
      <div class="presets" id="presetsContainer"></div>

      <button class="btn btn-primary" style="width: 100%;" id="analyzeBtn">
        <i class="ri-image-scan-line"></i> Upload & Analyze Image
      </button>
    </div>

    <!-- Clothing Selection -->
    <div class="card">
      <h2><i class="ri-shopping-bag-line"></i> Customize Your Outfit</h2>
      
      <div class="tabs">
        <button class="tab active" onclick="switchTab('tops')">üëï Tops</button>
        <button class="tab" onclick="switchTab('bottoms')">üëñ Bottoms</button>
        <button class="tab" onclick="switchTab('shoes')">üëû Shoes</button>
        <button class="tab" onclick="switchTab('accessories')">üíç Accessories</button>
      </div>

      <div id="clothingItems" class="clothing-grid"></div>
    </div>

    <!-- Saved Outfits -->
    <div class="saved-outfits">
      <h2><i class="ri-bookmark-line"></i> Saved Outfits</h2>
      <div id="savedOutfitsContainer">
        <p style="color: #999; text-align: center; padding: 20px;">No saved outfits yet. Create one to get started!</p>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const API_URL = 'http://127.0.0.1:8000/api';
    const userId = 'user_' + Date.now();
    let currentAvatar = null;
    let currentOutfit = {};
    let currentTab = 'tops';

    // Clothing database with images
    const clothingDatabase = {
      tops: [
        { id: 't1', name: 'Blue Shirt', image: 'https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=300&h=300&fit=crop', color: '#2563eb' },
        { id: 't2', name: 'Red Shirt', image: 'https://images.unsplash.com/photo-1552062407-c551eeda4bbb?w=300&h=300&fit=crop', color: '#dc2626' },
        { id: 't3', name: 'Green Shirt', image: 'https://images.unsplash.com/photo-1618886996028-b3b2e3e73d2f?w=300&h=300&fit=crop', color: '#16a34a' },
        { id: 't4', name: 'White Shirt', image: 'https://images.unsplash.com/photo-1596362051891-4ac5c5dc3f11?w=300&h=300&fit=crop', color: '#f5f5f5' },
        { id: 't5', name: 'Black Shirt', image: 'https://images.unsplash.com/photo-1578672767813-c82e22b92fa2?w=300&h=300&fit=crop', color: '#1f2937' },
        { id: 't6', name: 'Purple Shirt', image: 'https://images.unsplash.com/photo-1594938298603-c8148c4dae35?w=300&h=300&fit=crop', color: '#9333ea' },
        { id: 't7', name: 'Yellow Shirt', image: 'https://images.unsplash.com/photo-1514886291840-2e0a9bf2a9ae?w=300&h=300&fit=crop', color: '#fbbf24' },
        { id: 't8', name: 'Pink Shirt', image: 'https://images.unsplash.com/photo-1591195853828-11db59a44f6b?w=300&h=300&fit=crop', color: '#ec4899' },
      ],
      bottoms: [
        { id: 'b1', name: 'Blue Jeans', image: 'https://images.unsplash.com/photo-1542272604-787c62e4a69f?w=300&h=300&fit=crop', color: '#1e40af' },
        { id: 'b2', name: 'Black Jeans', image: 'https://images.unsplash.com/photo-1542272604-787c62e4a69f?w=300&h=300&fit=crop', color: '#000000' },
        { id: 'b3', name: 'Khaki Pants', image: 'https://images.unsplash.com/photo-1473032169651-f5c3e82c7202?w=300&h=300&fit=crop', color: '#d4a373' },
        { id: 'b4', name: 'Red Pants', image: 'https://images.unsplash.com/photo-1540028412853-a88627ee8a13?w=300&h=300&fit=crop', color: '#991b1b' },
        { id: 'b5', name: 'White Pants', image: 'https://images.unsplash.com/photo-1474876612894-66e9261d7d1b?w=300&h=300&fit=crop', color: '#ffffff' },
        { id: 'b6', name: 'Gray Pants', image: 'https://images.unsplash.com/photo-1542257905-efca3f926214?w=300&h=300&fit=crop', color: '#6b7280' },
        { id: 'b7', name: 'Green Pants', image: 'https://images.unsplash.com/photo-1541099649105-f69ad21f3246?w=300&h=300&fit=crop', color: '#15803d' },
        { id: 'b8', name: 'Brown Pants', image: 'https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?w=300&h=300&fit=crop', color: '#7c2d12' },
      ],
      shoes: [
        { id: 's1', name: 'Black Shoes', image: 'https://images.unsplash.com/photo-1543163521-32164c7e1a0b?w=300&h=300&fit=crop', color: '#000000' },
        { id: 's2', name: 'White Sneakers', image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop', color: '#ffffff' },
        { id: 's3', name: 'Red Heels', image: 'https://images.unsplash.com/photo-1548899460-2633b13be3f5?w=300&h=300&fit=crop', color: '#dc2626' },
        { id: 's4', name: 'Blue Shoes', image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop', color: '#2563eb' },
        { id: 's5', name: 'Brown Boots', image: 'https://images.unsplash.com/photo-1548899460-2633b13be3f5?w=300&h=300&fit=crop', color: '#92400e' },
        { id: 's6', name: 'Golden Heels', image: 'https://images.unsplash.com/photo-1595777707802-7ae82eb5daf5?w=300&h=300&fit=crop', color: '#fbbf24' },
        { id: 's7', name: 'Purple Shoes', image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop', color: '#6d28d9' },
        { id: 's8', name: 'Green Sneakers', image: 'https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=300&h=300&fit=crop', color: '#059669' },
      ],
      accessories: [
        { id: 'a1', name: 'Gold Watch', image: 'https://images.unsplash.com/photo-1523170335684-f042c03b1d9f?w=300&h=300&fit=crop', color: '#fbbf24' },
        { id: 'a2', name: 'Silver Necklace', image: 'https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=300&h=300&fit=crop', color: '#c0c0c0' },
        { id: 'a3', name: 'Black Hat', image: 'https://images.unsplash.com/photo-1614707267537-b85faf00021e?w=300&h=300&fit=crop', color: '#000000' },
        { id: 'a4', name: 'Red Bag', image: 'https://images.unsplash.com/photo-1548036328-c9fa89d128fa?w=300&h=300&fit=crop', color: '#dc2626' },
        { id: 'a5', name: 'Blue Scarf', image: 'https://images.unsplash.com/photo-1601924162398-ab92e327a7a8?w=300&h=300&fit=crop', color: '#2563eb' },
        { id: 'a6', name: 'Sunglasses', image: 'https://images.unsplash.com/photo-1572635196237-14b3f281503f?w=300&h=300&fit=crop', color: '#1f2937' },
        { id: 'a7', name: 'Gold Ring', image: 'https://images.unsplash.com/photo-1599643478518-a784e5dc4c8f?w=300&h=300&fit=crop', color: '#fbbf24' },
        { id: 'a8', name: 'Leather Belt', image: 'https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=300&h=300&fit=crop', color: '#92400e' },
      ]
    };

    // Drag & drop for image
    const uploadArea = document.getElementById('uploadArea');
    const avatarImageInput = document.getElementById('avatarImage');

    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('active');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('active');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('active');
      avatarImageInput.files = e.dataTransfer.files;
      previewImage();
    });

    avatarImageInput.addEventListener('change', previewImage);

    function previewImage() {
      const file = avatarImageInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          document.getElementById('avatarPreview').innerHTML = `<img src="${e.target.result}" alt="avatar">`;
        };
        reader.readAsDataURL(file);
      }
    }

    function showMessage(msg, type) {
      const box = document.getElementById('messageBox');
      box.textContent = msg;
      box.className = `message ${type}`;
      setTimeout(() => {
        box.className = 'message';
      }, 3000);
    }

    async function createAvatar() {
      try {
        let avatarImage = document.getElementById('avatarPreview').querySelector('img');
        let imageUrl = avatarImage ? avatarImage.src : null;

        const response = await fetch(`${API_URL}/avatar/create`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: userId,
            name: document.getElementById('avatarNameInput').value,
            skinTone: document.getElementById('skinTone').value,
            bodyType: document.getElementById('bodyType').value,
            avatarImage: imageUrl
          })
        });

        const data = await response.json();
        if (response.ok) {
          currentAvatar = data.avatar;
          document.getElementById('avatarName').textContent = currentAvatar.name;
          showMessage('Avatar created successfully!', 'success');
        } else {
          showMessage(data.message, 'error');
        }
      } catch (error) {
        showMessage('Error: ' + error.message, 'error');
      }
    }

    function switchTab(category) {
      currentTab = category;
      
      // Update active tab
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      event.target.classList.add('active');
      
      renderClothingItems(category);
    }

    function renderClothingItems(category) {
      const items = clothingDatabase[category] || [];
      const container = document.getElementById('clothingItems');
      
      container.innerHTML = items.map(item => `
        <div class="clothing-item" onclick="selectClothing('${category}', '${item.id}', this)">
          <div class="clothing-image">
            <img src="${item.image}" alt="${item.name}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22120%22 height=%22120%22%3E%3Crect fill=%22%23f0f0f0%22 width=%22120%22 height=%22120%22/%3E%3C/svg%3E'" />
          </div>
          <div class="clothing-name">${item.name}</div>
          <div class="clothing-color" style="background-color: ${item.color};"></div>
        </div>
      `).join('');
    }

    function selectClothing(category, itemId, element) {
      // Update current outfit
      currentOutfit[category] = itemId;
      
      // Visual feedback
      document.querySelectorAll('.clothing-item').forEach(item => {
        item.classList.remove('selected');
      });
      element.classList.add('selected');
      
      // Update avatar display
      updateOutfitDisplay();
    }

    function updateOutfitDisplay() {
      let outfitEmoji = '';
      
      if (currentOutfit.tops) {
        const top = clothingDatabase.tops.find(t => t.id === currentOutfit.tops);
        document.getElementById('outfit-top').textContent = top ? top.name : 'Select a top';
        outfitEmoji += top ? top.emoji : '';
      }
      
      if (currentOutfit.bottoms) {
        const bottom = clothingDatabase.bottoms.find(b => b.id === currentOutfit.bottoms);
        document.getElementById('outfit-bottom').textContent = bottom ? bottom.name : 'Select bottoms';
        outfitEmoji += bottom ? bottom.emoji : '';
      }
      
      if (currentOutfit.shoes) {
        const shoe = clothingDatabase.shoes.find(s => s.id === currentOutfit.shoes);
        document.getElementById('outfit-shoes').textContent = shoe ? shoe.name : 'Select shoes';
        outfitEmoji += shoe ? shoe.emoji : '';
      }
    }

    async function loadPresets() {
      try {
        const presets = {
          casual: 'Casual',
          formal: 'Formal',
          sporty: 'Sporty',
          traditional: 'Traditional',
          beach: 'Beach',
          party: 'Party'
        };

        const container = document.getElementById('presetsContainer');
        container.innerHTML = '';

        for (const [key, label] of Object.entries(presets)) {
          const btn = document.createElement('button');
          btn.className = 'preset-btn';
          btn.textContent = label;
          btn.onclick = () => applyPreset(key);
          container.appendChild(btn);
        }
      } catch (error) {
        console.error('Error loading presets:', error);
      }
    }

    async function applyPreset(preset) {
      try {
        const response = await fetch(`${API_URL}/avatar/${userId}/preset/${preset}`, {
          method: 'POST'
        });

        const data = await response.json();
        if (response.ok) {
          currentAvatar = data.avatar;
          updateOutfitDisplay();
          showMessage(`${preset} style applied!`, 'success');
        }
      } catch (error) {
        showMessage('Error applying preset', 'error');
      }
    }

    async function saveCurrentOutfit() {
      try {
        const response = await fetch(`${API_URL}/avatar/${userId}/save-outfit`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            outfitName: 'Outfit ' + new Date().toLocaleDateString(),
            outfit: currentAvatar.currentOutfit
          })
        });

        const data = await response.json();
        if (response.ok) {
          showMessage('Outfit saved successfully!', 'success');
          loadSavedOutfits();
        }
      } catch (error) {
        showMessage('Error saving outfit', 'error');
      }
    }

    async function loadSavedOutfits() {
      try {
        const response = await fetch(`${API_URL}/avatar/${userId}/outfits`);
        const data = await response.json();

        const container = document.getElementById('savedOutfitsContainer');
        if (data.outfits && data.outfits.length > 0) {
          container.innerHTML = data.outfits.map(outfit => `
            <div class="outfit-card">
              <div class="outfit-info">
                <h4>${outfit.name}</h4>
                <p>Top: ${outfit.outfit.top} | Bottom: ${outfit.outfit.bottom}</p>
              </div>
              <div class="outfit-actions">
                <button class="btn-load" onclick="loadOutfit(${outfit.id})">Load</button>
              </div>
            </div>
          `).join('');
        }
      } catch (error) {
        console.error('Error loading outfits:', error);
      }
    }

    function loadOutfit(outfitId) {
      showMessage('Outfit loaded!', 'success');
    }

    // Initialize
    loadPresets();
    renderClothingItems('tops');
    createAvatar();

    let avatarRotation = 0;

    // Rotate avatar
    function rotateAvatar(direction) {
      avatarRotation = direction === 'left' ? avatarRotation - 15 : avatarRotation + 15;
      const avatar = document.getElementById('avatarPreview');
      avatar.style.transform = `rotateY(${avatarRotation}deg)`;
    }

    // Download avatar
    function downloadAvatar() {
      const avatar = document.getElementById('avatarPreview');
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      canvas.width = 400;
      canvas.height = 500;
      
      // Create gradient background
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#667eea');
      gradient.addColorStop(1, '#764ba2');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Get outfit info
      let outfitText = 'My Dressify Avatar\n\n';
      if (currentOutfit.tops) {
        const top = clothingDatabase.tops.find(t => t.id === currentOutfit.tops);
        outfitText += top ? `Top: ${top.name}\n` : '';
      }
      if (currentOutfit.bottoms) {
        const bottom = clothingDatabase.bottoms.find(b => b.id === currentOutfit.bottoms);
        outfitText += bottom ? `Bottom: ${bottom.name}\n` : '';
      }
      if (currentOutfit.shoes) {
        const shoe = clothingDatabase.shoes.find(s => s.id === currentOutfit.shoes);
        outfitText += shoe ? `Shoes: ${shoe.name}\n` : '';
      }
      
      // Draw text
      ctx.fillStyle = 'white';
      ctx.font = 'bold 28px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Dressify AI Avatar', canvas.width / 2, 80);
      
      ctx.font = '16px Arial';
      ctx.fillText(document.getElementById('avatarName').textContent, canvas.width / 2, 130);
      
      ctx.font = '14px Arial';
      const lines = outfitText.split('\n').filter(l => l.trim());
      lines.forEach((line, i) => {
        ctx.fillText(line, canvas.width / 2, 200 + (i * 30));
      });
      
      // Download
      canvas.toBlob(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `avatar-${Date.now()}.png`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showMessage('Avatar downloaded successfully!', 'success');
      });
    }

    // Setup analyze button
    document.getElementById('analyzeBtn').addEventListener('click', () => {
      avatarImageInput.click();
    });

    // Navigation functions
    function toggleNavMenu() {
      const navMenu = document.getElementById('navMenu');
      navMenu.classList.toggle('active');
    }

    document.querySelectorAll('.nav-link').forEach(link => {
      link.addEventListener('click', () => {
        document.getElementById('navMenu').classList.remove('active');
      });
    });

    document.addEventListener('DOMContentLoaded', () => {
      const currentPage = window.location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('.nav-link').forEach(link => {
        const href = link.getAttribute('href');
        if (href === currentPage || (currentPage === '' && href === 'index.html')) {
          link.classList.add('active');
        }
      });
    });
</script>
</body>
</html>
